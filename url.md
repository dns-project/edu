Требования к оформлению URL
===========================

## Из чего состоит URL


<схема>://<логин>:<пароль>@<хост>:<порт>/<URL‐путь>?<параметры>#<якорь> (c) https://ru.wikipedia.org/wiki/URL

Нас больше всего инетересует формирование URL-пути и параметров, так как зачастую имено они отвечают за формирование уникального и правильного URL.

URL-путь состоит из вложенных папок и GET-параметров:

/<папка>/<папка>/<файл>

Как можно предположить это очень сильно напоминает файловую систему, ведь так оно и есть. Формируя URL-документа, мы руководствуемся этим правилом. И интуитивно предполагаем, что если уберем из URL файл, то попадем в папку, а стерев имя папки - попадем в родительсую папку. 

Проектируюя новый раздел всегда нужно руководствоваться этим. 

## Имя папки (slug)

Для имени папки, есть много ограничений. Они описаны в RFC, что бы легче запомнить мы опишем, что можно использовать нам:
* цифры и буквы (в латинском алфавите)
* знак нижнего подчеркивания

и как дополнительное тербование нижний регистр всех символов, в регулярном выражении выглядит так #[a-z0-9\_]#

## Как правильно очистить имя папки

Достаточно часто имя папки формируется из данных поступающих из вне. И нередко мы формируем URL из строки похожей на &laquo;&quot;Производитель/LEVI&#39;S® & Co&quot;&raquo;, при этом только имя папки. 

Как очищаем:

* Преобразуем Html-Entity в символы (http://php.net/manual/ru/function.html-entity-decode.php)
* Очищаем текст от HTML (http://php.net/manual/ru/function.strip-tags.php)
* Переводим в транслит не русский текст (незабываем, что могут быть разные исходные языки)
* Заменям символ & на "_and_"
* Заменям символ / на "_slash_"
* Разбираемся с символами
 * убираем все кавычки
 * убираем все неразрешенные символы
 * заменяем пробельные символы, знак тире, и прочие не буквы, не цифры, на символ подчекриваня
* убираем двойные подчеркивания и подчеркивания вначале и вконце

Если применить наши правила к примеру выше, то получим: &laquo;proizvoditel_slash_levis_and_co&raquo;

## Параметры

GET-параметры принимают очень большое значение в формировании URL, разная поочередность дает другой уникальный адрес, но с абсолютно идентичным содржимым. Для этого нужно пасполагать параметры в алфивитном порядке. 

Система, на уровне движка должна, проверять все входящие данные и если входной URL имеет не правильный порядок GET элементов, уведомлять клиента о том что документ располагается по другому адресу и перенаправлять его на этот адрес. 

То есть если клиент пришел на адрес
/some/thing/?b=1&a=1

Ответ сервера должен содержать заголовок
Location: /some/thing/?a=1&b=1

что приведет к перенаправлению клиента, на правильный URL

### Наименование параметров

Как правило GET параметры можно разделить на несколько видов:

* Параметры ограничивающие вывод (Filter)
* Параметры меняющие поочередность (Order)
* Параметры меняющие вид всей страницы или только части (View)
* Внешние параметры (маркетинговые - "utm_", счетчики и т.д.) 

Внешние параметры мы не обрабатываем, они нужны для каких-то иных целей.

Мы используем параметры в следующей нотации: 

filter[what][sub][sub] = value
order[how][sub][sub] = value
view[how][sub][sub] = value

то есть для фильтрации данных на странице по минимальной и максимальной цене, нужно использовать: 

filter[price][max]=100&filter[price][min]=10 (обратите внимание, параметры выстроены по-имени)

## Стандартные наименования


<table>
  <tr>
    <th>Name</th><th>Значение поля</th><th>Назначение</th>
  </tr>
  <tr>
    <td colspan="3">filter - фильтрация</td>
  </tr>
  <tr>
    <td>[price][min]</td><td>int</td><td>Минимальная цена</td>
  </tr>
  <tr>
    <td>[price][max]</td><td>int</td><td>Максимальная цена</td>
  </tr>
  <tr>
    <td>[price][currency]</td><td>USD|RUB|EUR...</td><td>Валюта</td>
  </tr>
  <tr>
    <td>[price][type]</td><td>with_discount</td><td>Тип цены, например товары со скидкой</td>
  </tr>
</table>

## Правило &laquo;А. Лебедева&raquo;

Правило: посетитель всегда должен получить осмысленное и предсказуемое содержимое, если он стер часть адреса до ближайшей косой черты. 
Источник: http://www.artlebedev.ru/kovodstvo/sections/48/

## Порядок GET-праметров

По алфавиту

## Запрещенные символы в URL см RFC 2396

- управляющие коды из кодировки US-ASCII с шестнадцатеричными значениями 00 до 1F и 7F.
- символ пробела (20)
- разделители "<" | ">" | "#" | "%" | <">
- символы "{" | "}" | "|" | "\" | "^" | "[" | "]" | "`" | ";" | "?" | ":" | "@" | "&" | "=" | "+" | "$" | ","
- символы национальных алфавитов не входящие в кодировку US-ASCII

## Ссылки по теме

* https://ru.wikipedia.org/wiki/URL
* http://en.wikipedia.org/wiki/Slug_(programming)#Slug
* https://ru.wikipedia.org/wiki/%D0%A7%D0%9F%D0%A3_(%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82)
* http://www.w3schools.com/tags/ref_urlencode.asp
